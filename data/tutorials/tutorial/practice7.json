{"variants":[{"paths":["\/tutorials\/tutorial\/practice7"],"traits":[{"interfaceLanguage":"swift"}]}],"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[{"kind":"hero","title":"課題7: 無限スクロールを実装してみよう","chapter":"課題7: 無限スクロールを実装してみよう","estimatedTimeInMinutes":60,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"おすすめのイラストは、スクロールで下まで読み込んだら次のイラストを表示するようにしたいです"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"IllustAPIMockはページング処理を検証しやすいように4個ずつイラストを読み込むようになっています。実際の開発ではそこまで少ないことはなく、10個とか20個にすることが多いと思います"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"以下は解答になります。この教材では、まず解答を見ずにインターネット等を見て自分で書いてみることをおすすめしています。15分以上詰まったら見るという使い方をしても大丈夫です"}]}]},{"kind":"tasks","tasks":[{"anchor":"解答-無限スクロールを実装する","title":"解答: 無限スクロールを実装する","contentSection":[{"kind":"contentAndMedia","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"UIScrollViewDelegateを使い、下までスクロールされたらAPIを叩くという処理を書きます。APIのgetRecommendedにはoffsetオプションがあるので、これを使って5枚目以上のイラストを読み込みます"}]}],"mediaPosition":"trailing"}],"stepsSection":[{"code":"Practice7_Section1_MainViewController_1.swift","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"CollectionViewが最後まで読み込まれたことを判定する処理を作ります。いくつか方法がありますが、UIScrollViewDelegateの "},{"type":"codeVoice","code":"func scrollViewDidScroll(_ scrollView: UIScrollView)"},{"type":"text","text":" を使います"}]}],"caption":[],"type":"step","runtimePreview":null,"media":null},{"code":"Practice7_Section1_MainViewController_2.swift","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Y軸のスクロールの量(contentOffset.y)が、scrollView内の内容の高さからscrollView自体の高さを引いた値より大きければ一番下まで読み込まれたと判定することにします。下まで読み込んだらViewModelに次のイラストを取得して欲しいことを伝えます"}]}],"caption":[],"type":"step","runtimePreview":null,"media":null},{"code":"Practice7_Section1_IllustViewModel_1.swift","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"ViewModelにfetchNextIllustsメソッドを実装していきます"}]}],"caption":[],"type":"step","runtimePreview":null,"media":null},{"code":"Practice7_Section1_IllustViewModel_2.swift","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"APIのgetRecommendedにはoffsetを指定できるオプションがあります。現在のrecommendedIllustsの個数をoffsetとして記録しておき、それを使用してページングの処理を書いていきます"}]}],"caption":[],"type":"step","runtimePreview":null,"media":null},{"code":"Practice7_Section1_IllustViewModel_3.swift","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"MainViewControllerのスクロールの判定は何度も呼ばれてしまう可能性があります。その度に無駄なAPIリクエストが発生しないようにisRequestingがtrueの際は早期リターンするようにします"}]}],"caption":[],"type":"step","runtimePreview":null,"media":null},{"code":"Practice7_Section1_IllustViewModel_4.swift","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"また、前回のリクエストが空だった場合も作品が存在しないということなので、リクエストしないように防ぎます"}]}],"caption":[],"type":"step","runtimePreview":null,"media":null}]}]},{"action":{"overridingTitleInlineContent":[{"type":"text","text":"Get started"}],"isActive":true,"type":"reference","identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice8","overridingTitle":"Get started"},"featuredEyebrow":"Tutorial","kind":"callToAction","title":"課題8: いいねボタンを実装してみよう","abstract":[{"type":"text","text":"おすすめのイラストのCellにいいねボタンを表示してみましょう。また、いいねしたことをAPIを叩いて記録しましょう。いいねを取り消す処理は実装しなくても大丈夫です"}]}],"identifier":{"url":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice7","interfaceLanguage":"swift"},"kind":"project","metadata":{"title":"課題7: 無限スクロールを実装してみよう","categoryPathComponent":"TableOfContents","role":"project","category":"お絵かきSNSを作ってみよう"},"hierarchy":{"modules":[{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--1:------2----------------","projects":[{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice1","sections":[{"kind":"task","reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice1#%E8%A7%A3%E7%AD%94-2%E5%88%97%E8%A1%A8%E7%A4%BA%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF%E3%82%92%E4%BD%9C%E3%82%8B"}]}]},{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--2:-----------------","projects":[{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice2","sections":[{"kind":"task","reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice2#%E8%A7%A3%E7%AD%94-%E3%83%98%E3%83%83%E3%83%80%E3%83%BC%E3%82%92%E4%BD%9C%E3%82%8B"}]}]},{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--3:-------------------","projects":[{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice3","sections":[{"kind":"task","reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice3#%E8%A7%A3%E7%AD%94-%E3%83%A9%E3%83%B3%E3%82%AD%E3%83%B3%E3%82%B0%E3%81%AE%E3%82%BB%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8B"},{"kind":"task","reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice3#%E8%A7%A3%E7%AD%94-%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E7%AE%A1%E7%90%86%E3%81%97%E3%82%84%E3%81%99%E3%81%8F%E3%81%99%E3%82%8B"},{"kind":"task","reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice3#%E8%A7%A3%E7%AD%94-%E3%83%A9%E3%83%B3%E3%82%AD%E3%83%B3%E3%82%B0%E3%81%AE%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"}]}]},{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--4:-------------------","projects":[{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice4","sections":[{"kind":"task","reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice4#%E8%A7%A3%E7%AD%94-%E3%82%A4%E3%83%A9%E3%82%B9%E3%83%88%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8B"},{"kind":"task","reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice4#%E8%A7%A3%E7%AD%94-Nuke%E3%81%A7%E7%94%BB%E5%83%8F%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B"}]}]},{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--5:-ViewModel-------","projects":[{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice5","sections":[{"kind":"task","reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice5#%E8%A7%A3%E7%AD%94-ViewModel%E3%82%92%E4%BD%9C%E3%82%8B"}]}]},{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--6:----(----)----------","projects":[{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice6","sections":[{"kind":"task","reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice6#%E8%A7%A3%E7%AD%94-%E3%83%AD%E3%83%BC%E3%83%89%E4%B8%AD%E3%81%AE%E6%8C%99%E5%8B%95%E3%82%92%E4%BD%9C%E3%82%8B"}]}]},{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--7:----------------","projects":[{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice7","sections":[{"kind":"task","reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice7#%E8%A7%A3%E7%AD%94-%E7%84%A1%E9%99%90%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"}]}]},{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--8:---------------","projects":[{"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice8","sections":[{"kind":"task","reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice8#%E8%A7%A3%E7%AD%94-%E3%81%84%E3%81%84%E3%81%AD%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"}]}]}],"reference":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents","paths":[["doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents","doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/$volume","doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--7:----------------"]]},"references":{"doc://net.pixiv.training.Tutorial/tutorials/TableOfContents/--3:-------------------":{"role":"article","title":"課題3: ランキングのセクションを作ってみよう","abstract":[],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--3:-------------------","kind":"article","type":"topic","url":"\/tutorials\/tableofcontents\/--3:-------------------"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice2#%E8%A7%A3%E7%AD%94-%E3%83%98%E3%83%83%E3%83%80%E3%83%BC%E3%82%92%E4%BD%9C%E3%82%8B":{"role":"pseudoSymbol","title":"解答: ヘッダーを作る","abstract":[{"type":"text","text":"2列表示のセクションの上にヘッダーを作って、何のコンテンツの領域かわかるようにしてみましょう"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice2#%E8%A7%A3%E7%AD%94-%E3%83%98%E3%83%83%E3%83%80%E3%83%BC%E3%82%92%E4%BD%9C%E3%82%8B","kind":"section","type":"section","url":"\/tutorials\/tutorial\/practice2#%25E8%25A7%25A3%25E7%25AD%2594-%25E3%2583%2598%25E3%2583%2583%25E3%2583%2580%25E3%2583%25BC%25E3%2582%2592%25E4%25BD%259C%25E3%2582%258B"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice1":{"role":"project","title":"課題1: イラストを2列で表示する仕組みを作ってみよう","estimatedTime":"1hr 0min","abstract":[{"type":"text","text":"イラストを2列で表示する仕組みを作っていきましょう。実際に画像を表示するのはこの先のSectionで扱うので、一旦2列表示の仕組みが作れればOKです"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice1","kind":"project","type":"topic","url":"\/tutorials\/tutorial\/practice1"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice8#%E8%A7%A3%E7%AD%94-%E3%81%84%E3%81%84%E3%81%AD%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B":{"role":"pseudoSymbol","title":"解答: いいねボタンを実装する","abstract":[{"type":"text","text":"おすすめのイラストのCellにいいねボタンを表示してみましょう。また、いいねしたことをAPIを叩いて記録しましょう。いいねを取り消す処理は実装しなくても大丈夫です"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice8#%E8%A7%A3%E7%AD%94-%E3%81%84%E3%81%84%E3%81%AD%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B","kind":"section","type":"section","url":"\/tutorials\/tutorial\/practice8#%25E8%25A7%25A3%25E7%25AD%2594-%25E3%2581%2584%25E3%2581%2584%25E3%2581%25AD%25E3%2583%259C%25E3%2582%25BF%25E3%2583%25B3%25E3%2582%2592%25E5%25AE%259F%25E8%25A3%2585%25E3%2581%2599%25E3%2582%258B"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice1#%E8%A7%A3%E7%AD%94-2%E5%88%97%E8%A1%A8%E7%A4%BA%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF%E3%82%92%E4%BD%9C%E3%82%8B":{"role":"pseudoSymbol","title":"解答: 2列表示の仕組みを作る","abstract":[{"type":"text","text":"イラストを2列で表示する仕組みを作っていきましょう。実際に画像を表示するのはこの先のSectionで扱うので、一旦2列表示の仕組みが作れればOKです"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice1#%E8%A7%A3%E7%AD%94-2%E5%88%97%E8%A1%A8%E7%A4%BA%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF%E3%82%92%E4%BD%9C%E3%82%8B","kind":"section","type":"section","url":"\/tutorials\/tutorial\/practice1#%25E8%25A7%25A3%25E7%25AD%2594-2%25E5%2588%2597%25E8%25A1%25A8%25E7%25A4%25BA%25E3%2581%25AE%25E4%25BB%2595%25E7%25B5%2584%25E3%2581%25BF%25E3%2582%2592%25E4%25BD%259C%25E3%2582%258B"},"doc://net.pixiv.training.Tutorial/tutorials/TableOfContents":{"role":"overview","title":"はじめに","abstract":[{"type":"text","text":"お絵かきSNSの開発を通して、実例に近いiOSアプリ開発を学んでいきましょう"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents","kind":"overview","type":"topic","url":"\/tutorials\/tableofcontents"},"doc://net.pixiv.training.Tutorial/tutorials/TableOfContents/--6:----(----)----------":{"role":"article","title":"課題6: 通信中(ロード中)の挙動を作ってみよう","abstract":[],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--6:----(----)----------","kind":"article","type":"topic","url":"\/tutorials\/tableofcontents\/--6:----(----)----------"},"Practice7_Section1_IllustViewModel_2.swift":{"syntax":"swift","content":["import Combine","import IllustAPIMock","","final class IllustViewModel {","    @Published var rankingIllusts: [Illust] = []","    @Published var recommendedIllusts: [Illust] = []","    @Published var offset: Int = 0","    @Published var isRequesting: Bool = false","","    private let api: IllustAPIMock","","    init(api: IllustAPIMock) {","        self.api = api","    }","","    func fetchIllusts() async {","        isRequesting = true","        do {","            rankingIllusts = try await api.getRanking()","            recommendedIllusts = try await api.getRecommended()","            offset = recommendedIllusts.count","        } catch {","            print(error)","        }","        isRequesting = false","    }","","    func fetchNextIllusts() async {","        isRequesting = true","        do {","            let illusts = try await api.getRecommended(offset: offset)","            self.recommendedIllusts += illusts","            self.offset += illusts.count","        } catch {","            print(error)","        }","        isRequesting = false","    }","}"],"fileName":"IllustViewModel.swift","identifier":"Practice7_Section1_IllustViewModel_2.swift","type":"file","fileType":"swift","highlights":[{"line":7},{"line":21},{"line":29},{"line":30},{"line":31},{"line":32},{"line":33},{"line":34},{"line":35},{"line":36},{"line":37}]},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice2":{"role":"project","title":"課題2: おすすめのヘッダーを作ってみよう","estimatedTime":"40min","abstract":[{"type":"text","text":"2列表示のセクションの上にヘッダーを作って、何のコンテンツの領域かわかるようにしてみましょう"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice2","kind":"project","type":"topic","url":"\/tutorials\/tutorial\/practice2"},"doc://net.pixiv.training.Tutorial/tutorials/TableOfContents/--2:-----------------":{"role":"article","title":"課題2: おすすめのヘッダーを作ってみよう","abstract":[],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--2:-----------------","kind":"article","type":"topic","url":"\/tutorials\/tableofcontents\/--2:-----------------"},"Practice7_Section1_MainViewController_2.swift":{"syntax":"swift","content":["import Combine","import IllustAPIMock","import UIKit","","class MainViewController: UIViewController {","    @IBOutlet private weak var collectionView: UICollectionView! {","        didSet {","            collectionView.delegate = self","            collectionView.dataSource = self","            registerCells()","        }","    }","    @IBOutlet private weak var loadingView: UIActivityIndicatorView!","","    private var sections: [Section] = [] {","        didSet {","            Task { @MainActor in","                self.collectionView.collectionViewLayout = {","                    let layout = UICollectionViewCompositionalLayout { (sectionIndex, environment) -> NSCollectionLayoutSection? in","                        return self.sections[sectionIndex].layoutSection()","                    }","                    return layout","                }()","                self.collectionView.reloadData()","            }","        }","    }","","    private let viewModel = IllustViewModel(api: IllustAPIMock())","    private var cancellables = Set<AnyCancellable>()","","    override func viewDidLoad() {","        super.viewDidLoad()","","        viewModel.$rankingIllusts","            .combineLatest(viewModel.$recommendedIllusts)","            .receive(on: DispatchQueue.main)","            .sink { [weak self] rankingIllusts, recommendedIllusts in","                guard let self = self else {","                    return","                }","                self.sections = [","                    RankingIllustSection(illusts: rankingIllusts),","                    IllustSection(illusts: recommendedIllusts, parentWidth: self.view.bounds.width)","                ]","            }","            .store(in: &cancellables)","","        viewModel.$isRequesting","            .receive(on: DispatchQueue.main)","            .sink { [weak self] isRequesting in","                self?.loadingView.isHidden = !isRequesting","            }","            .store(in: &cancellables)","","        Task {","            await viewModel.fetchIllusts()","        }","    }","}","","extension MainViewController: UIScrollViewDelegate {","    func scrollViewDidScroll(_ scrollView: UIScrollView) {","        guard scrollView.contentOffset.y >= scrollView.contentSize.height - scrollView.frame.size.height else {","            return","        }","        Task {","            await viewModel.fetchNextIllusts()","        }","    }","}","","extension MainViewController {","    private func registerCells() {","        collectionView.register(UINib(nibName: \"HeaderCell\", bundle: nil), forSupplementaryViewOfKind: \"RecommendedHeader\", withReuseIdentifier: \"HeaderCell\")","        collectionView.register(UINib(nibName: \"HeaderCell\", bundle: nil), forSupplementaryViewOfKind: \"RankingHeader\", withReuseIdentifier: \"HeaderCell\")","        collectionView.register(UINib(nibName: \"IllustCell\", bundle: nil),  forCellWithReuseIdentifier: \"IllustCell\")","        collectionView.register(UINib(nibName: \"RankingIllustCell\", bundle: nil),  forCellWithReuseIdentifier: \"RankingIllustCell\")","    }","}","","extension MainViewController: UICollectionViewDelegate {","}","","extension MainViewController: UICollectionViewDataSource {","    func numberOfSections(in collectionView: UICollectionView) -> Int {","        return sections.count","    }","","    func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -> Int {","        return sections[section].numberOfItems","    }","","    func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -> UICollectionViewCell {","        return sections[indexPath.section].configureCell(collectionView: collectionView, indexPath: indexPath)","    }","","    func collectionView(_ collectionView: UICollectionView, viewForSupplementaryElementOfKind kind: String, at indexPath: IndexPath) -> UICollectionReusableView {","        guard let header = collectionView.dequeueReusableSupplementaryView(ofKind: kind, withReuseIdentifier: \"HeaderCell\", for: indexPath) as? HeaderCell else {","            fatalError()","        }","        switch kind {","        case \"RecommendedHeader\":","            header.bind(\"Recommended\")","            return header","        case \"RankingHeader\":","            header.bind(\"Ranking\")","            return header","        default:","            fatalError()","         }","    }","}"],"fileName":"MainViewController.swift","identifier":"Practice7_Section1_MainViewController_2.swift","type":"file","fileType":"swift","highlights":[{"line":64},{"line":65},{"line":66},{"line":67},{"line":68},{"line":69}]},"doc://net.pixiv.training.Tutorial/tutorials/TableOfContents/--8:---------------":{"role":"article","title":"課題8: いいねボタンを実装してみよう","abstract":[],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--8:---------------","kind":"article","type":"topic","url":"\/tutorials\/tableofcontents\/--8:---------------"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice7":{"role":"project","title":"課題7: 無限スクロールを実装してみよう","estimatedTime":"1hr 0min","abstract":[{"type":"text","text":"おすすめのイラストは、スクロールで下まで読み込んだら次のイラストを表示するようにしたいです"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice7","kind":"project","type":"topic","url":"\/tutorials\/tutorial\/practice7"},"doc://net.pixiv.training.Tutorial/tutorials/TableOfContents/--1:------2----------------":{"role":"article","title":"課題1: イラストを2列で表示する仕組みを作ってみよう","abstract":[],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--1:------2----------------","kind":"article","type":"topic","url":"\/tutorials\/tableofcontents\/--1:------2----------------"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice4":{"role":"project","title":"課題4: イラストの情報を取ってきて表示しよう","estimatedTime":"1hr 0min","abstract":[{"type":"text","text":"今まで作った仮のUIに実際にイラストの情報を取ってきて表示してみましょう"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice4","kind":"project","type":"topic","url":"\/tutorials\/tutorial\/practice4"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice4#%E8%A7%A3%E7%AD%94-%E3%82%A4%E3%83%A9%E3%82%B9%E3%83%88%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8B":{"role":"pseudoSymbol","title":"解答: イラストの情報を取ってくる","abstract":[{"type":"text","text":"今まで作った仮のUIに実際にイラストの情報を取ってきて表示してみましょう"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice4#%E8%A7%A3%E7%AD%94-%E3%82%A4%E3%83%A9%E3%82%B9%E3%83%88%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8B","kind":"section","type":"section","url":"\/tutorials\/tutorial\/practice4#%25E8%25A7%25A3%25E7%25AD%2594-%25E3%2582%25A4%25E3%2583%25A9%25E3%2582%25B9%25E3%2583%2588%25E3%2581%25AE%25E6%2583%2585%25E5%25A0%25B1%25E3%2582%2592%25E5%258F%2596%25E3%2581%25A3%25E3%2581%25A6%25E3%2581%258F%25E3%2582%258B"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice7#%E8%A7%A3%E7%AD%94-%E7%84%A1%E9%99%90%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B":{"role":"pseudoSymbol","title":"解答: 無限スクロールを実装する","abstract":[{"type":"text","text":"おすすめのイラストは、スクロールで下まで読み込んだら次のイラストを表示するようにしたいです"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice7#%E8%A7%A3%E7%AD%94-%E7%84%A1%E9%99%90%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B","kind":"section","type":"section","url":"\/tutorials\/tutorial\/practice7#%25E8%25A7%25A3%25E7%25AD%2594-%25E7%2584%25A1%25E9%2599%2590%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AD%25E3%2583%25BC%25E3%2583%25AB%25E3%2582%2592%25E5%25AE%259F%25E8%25A3%2585%25E3%2581%2599%25E3%2582%258B"},"doc://net.pixiv.training.Tutorial/tutorials/TableOfContents/--7:----------------":{"role":"article","title":"課題7: 無限スクロールを実装してみよう","abstract":[],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--7:----------------","kind":"article","type":"topic","url":"\/tutorials\/tableofcontents\/--7:----------------"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice6#%E8%A7%A3%E7%AD%94-%E3%83%AD%E3%83%BC%E3%83%89%E4%B8%AD%E3%81%AE%E6%8C%99%E5%8B%95%E3%82%92%E4%BD%9C%E3%82%8B":{"role":"pseudoSymbol","title":"解答: ロード中の挙動を作る","abstract":[{"type":"text","text":"通信中、何も表示されてないとユーザーはアプリが壊れているのか、ネットワークが遅いのか知ることができません。APIとの通信中はくるくるを出してあげるようにしてみましょう"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice6#%E8%A7%A3%E7%AD%94-%E3%83%AD%E3%83%BC%E3%83%89%E4%B8%AD%E3%81%AE%E6%8C%99%E5%8B%95%E3%82%92%E4%BD%9C%E3%82%8B","kind":"section","type":"section","url":"\/tutorials\/tutorial\/practice6#%25E8%25A7%25A3%25E7%25AD%2594-%25E3%2583%25AD%25E3%2583%25BC%25E3%2583%2589%25E4%25B8%25AD%25E3%2581%25AE%25E6%258C%2599%25E5%258B%2595%25E3%2582%2592%25E4%25BD%259C%25E3%2582%258B"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice3#%E8%A7%A3%E7%AD%94-%E3%83%A9%E3%83%B3%E3%82%AD%E3%83%B3%E3%82%B0%E3%81%AE%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B":{"role":"pseudoSymbol","title":"解答: ランキングのセクションを作成する","abstract":[{"type":"text","text":"課題1・2で作ったセクションの上に、ランキングを配置するセクションを作ってみましょう"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice3#%E8%A7%A3%E7%AD%94-%E3%83%A9%E3%83%B3%E3%82%AD%E3%83%B3%E3%82%B0%E3%81%AE%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B","kind":"section","type":"section","url":"\/tutorials\/tutorial\/practice3#%25E8%25A7%25A3%25E7%25AD%2594-%25E3%2583%25A9%25E3%2583%25B3%25E3%2582%25AD%25E3%2583%25B3%25E3%2582%25B0%25E3%2581%25AE%25E3%2582%25BB%25E3%2582%25AF%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%25B3%25E3%2582%2592%25E4%25BD%259C%25E6%2588%2590%25E3%2581%2599%25E3%2582%258B"},"doc://net.pixiv.training.Tutorial/tutorials/TableOfContents/--4:-------------------":{"role":"article","title":"課題4: イラストの情報を取ってきて表示しよう","abstract":[],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--4:-------------------","kind":"article","type":"topic","url":"\/tutorials\/tableofcontents\/--4:-------------------"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice6":{"role":"project","title":"課題6: 通信中(ロード中)の挙動を作ってみよう","estimatedTime":"20min","abstract":[{"type":"text","text":"通信中、何も表示されてないとユーザーはアプリが壊れているのか、ネットワークが遅いのか知ることができません。APIとの通信中はくるくるを出してあげるようにしてみましょう"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice6","kind":"project","type":"topic","url":"\/tutorials\/tutorial\/practice6"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice3":{"role":"project","title":"課題3: ランキングのセクションを作ってみよう","estimatedTime":"1hr 0min","abstract":[{"type":"text","text":"課題1・2で作ったセクションの上に、ランキングを配置するセクションを作ってみましょう"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice3","kind":"project","type":"topic","url":"\/tutorials\/tutorial\/practice3"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice5":{"role":"project","title":"課題5: ViewModelを作ってみよう","estimatedTime":"1hr 0min","abstract":[{"type":"text","text":"ViewModelにはUIに表示するためのプロパティを保持したり、APIを叩くなどの処理を行うためのメソッドを生やしていきます。そうすることでViewControllerはその値を見る(購読する)のと、処理を呼び出すだけの存在になり、シンプルなものになっていきます"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice5","kind":"project","type":"topic","url":"\/tutorials\/tutorial\/practice5"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice3#%E8%A7%A3%E7%AD%94-%E3%83%A9%E3%83%B3%E3%82%AD%E3%83%B3%E3%82%B0%E3%81%AE%E3%82%BB%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8B":{"role":"pseudoSymbol","title":"解答: ランキングのセルを作る","abstract":[{"type":"text","text":"課題1・2で作ったセクションの上に、ランキングを配置するセクションを作ってみましょう"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice3#%E8%A7%A3%E7%AD%94-%E3%83%A9%E3%83%B3%E3%82%AD%E3%83%B3%E3%82%B0%E3%81%AE%E3%82%BB%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8B","kind":"section","type":"section","url":"\/tutorials\/tutorial\/practice3#%25E8%25A7%25A3%25E7%25AD%2594-%25E3%2583%25A9%25E3%2583%25B3%25E3%2582%25AD%25E3%2583%25B3%25E3%2582%25B0%25E3%2581%25AE%25E3%2582%25BB%25E3%2583%25AB%25E3%2582%2592%25E4%25BD%259C%25E3%2582%258B"},"Practice7_Section1_IllustViewModel_3.swift":{"syntax":"swift","content":["import Combine","import IllustAPIMock","","@MainActor","final class IllustViewModel {","    @Published var rankingIllusts: [Illust] = []","    @Published var recommendedIllusts: [Illust] = []","    @Published var offset: Int = 0","    @Published var isRequesting: Bool = false","","    private let api: IllustAPIMock","","    init(api: IllustAPIMock) {","        self.api = api","    }","","    func fetchIllusts() async {","        isRequesting = true","        do {","            rankingIllusts = try await api.getRanking()","            recommendedIllusts = try await api.getRecommended()","            offset = recommendedIllusts.count","        } catch {","            print(error)","        }","        isRequesting = false","    }","","    func fetchNextIllusts() async {","        guard !isRequesting else {","            return","        }","        isRequesting = true","        do {","            let illusts = try await api.getRecommended(offset: offset)","            self.recommendedIllusts += illusts","            self.offset = recommendedIllusts.count","        } catch {","            print(error)","        }","        isRequesting = false","    }","}"],"fileName":"IllustViewModel.swift","identifier":"Practice7_Section1_IllustViewModel_3.swift","type":"file","fileType":"swift","highlights":[{"line":4},{"line":30},{"line":31},{"line":32},{"line":37}]},"Practice7_Section1_IllustViewModel_4.swift":{"syntax":"swift","content":["import Combine","import IllustAPIMock","","@MainActor","final class IllustViewModel {","    @Published var rankingIllusts: [Illust] = []","    @Published var recommendedIllusts: [Illust] = []","    @Published var offset: Int = 0","    @Published var hasNext: Bool = false","    @Published var isRequesting: Bool = false","","    private let api: IllustAPIMock","","    init(api: IllustAPIMock) {","        self.api = api","    }","","    func fetchIllusts() async {","        isRequesting = true","        do {","            rankingIllusts = try await api.getRanking()","            recommendedIllusts = try await api.getRecommended()","            offset = recommendedIllusts.count","            hasNext = !recommendedIllusts.isEmpty","        } catch {","            print(error)","        }","        isRequesting = false","    }","","    func fetchNextIllusts() async {","        guard !isRequesting else {","            return","        }","        guard hasNext else {","            return","        }","        isRequesting = true","        do {","            let illusts = try await api.getRecommended(offset: offset)","            self.recommendedIllusts += illusts","            self.offset = recommendedIllusts.count","            self.hasNext = !illusts.isEmpty","        } catch {","            print(error)","        }","        isRequesting = false","    }","}"],"fileName":"IllustViewModel.swift","identifier":"Practice7_Section1_IllustViewModel_4.swift","type":"file","fileType":"swift","highlights":[{"line":9},{"line":24},{"line":35},{"line":36},{"line":37},{"line":43}]},"Practice7_Section1_IllustViewModel_1.swift":{"syntax":"swift","content":["import Combine","import IllustAPIMock","","final class IllustViewModel {","    @Published var rankingIllusts: [Illust] = []","    @Published var recommendedIllusts: [Illust] = []","    @Published var isRequesting: Bool = false","","    private let api: IllustAPIMock","","    init(api: IllustAPIMock) {","        self.api = api","    }","","    func fetchIllusts() async {","        isRequesting = true","        do {","            rankingIllusts = try await api.getRanking()","            recommendedIllusts = try await api.getRecommended()","        } catch {","            print(error)","        }","        isRequesting = false","    }","","    func fetchNextIllusts() async {","    }","}"],"fileName":"IllustViewModel.swift","identifier":"Practice7_Section1_IllustViewModel_1.swift","type":"file","fileType":"swift","highlights":[{"line":25},{"line":26},{"line":27}]},"doc://net.pixiv.training.Tutorial/tutorials/TableOfContents/--5:-ViewModel-------":{"role":"article","title":"課題5: ViewModelを作ってみよう","abstract":[],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/TableOfContents\/--5:-ViewModel-------","kind":"article","type":"topic","url":"\/tutorials\/tableofcontents\/--5:-viewmodel-------"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice4#%E8%A7%A3%E7%AD%94-Nuke%E3%81%A7%E7%94%BB%E5%83%8F%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B":{"role":"pseudoSymbol","title":"解答: Nukeで画像を表示する","abstract":[{"type":"text","text":"今まで作った仮のUIに実際にイラストの情報を取ってきて表示してみましょう"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice4#%E8%A7%A3%E7%AD%94-Nuke%E3%81%A7%E7%94%BB%E5%83%8F%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B","kind":"section","type":"section","url":"\/tutorials\/tutorial\/practice4#%25E8%25A7%25A3%25E7%25AD%2594-Nuke%25E3%2581%25A7%25E7%2594%25BB%25E5%2583%258F%25E3%2582%2592%25E8%25A1%25A8%25E7%25A4%25BA%25E3%2581%2599%25E3%2582%258B"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice5#%E8%A7%A3%E7%AD%94-ViewModel%E3%82%92%E4%BD%9C%E3%82%8B":{"role":"pseudoSymbol","title":"解答: ViewModelを作る","abstract":[{"type":"text","text":"ViewModelにはUIに表示するためのプロパティを保持したり、APIを叩くなどの処理を行うためのメソッドを生やしていきます。そうすることでViewControllerはその値を見る(購読する)のと、処理を呼び出すだけの存在になり、シンプルなものになっていきます"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice5#%E8%A7%A3%E7%AD%94-ViewModel%E3%82%92%E4%BD%9C%E3%82%8B","kind":"section","type":"section","url":"\/tutorials\/tutorial\/practice5#%25E8%25A7%25A3%25E7%25AD%2594-ViewModel%25E3%2582%2592%25E4%25BD%259C%25E3%2582%258B"},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice3#%E8%A7%A3%E7%AD%94-%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E7%AE%A1%E7%90%86%E3%81%97%E3%82%84%E3%81%99%E3%81%8F%E3%81%99%E3%82%8B":{"role":"pseudoSymbol","title":"解答: セクションを管理しやすくする","abstract":[{"type":"text","text":"課題1・2で作ったセクションの上に、ランキングを配置するセクションを作ってみましょう"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice3#%E8%A7%A3%E7%AD%94-%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E7%AE%A1%E7%90%86%E3%81%97%E3%82%84%E3%81%99%E3%81%8F%E3%81%99%E3%82%8B","kind":"section","type":"section","url":"\/tutorials\/tutorial\/practice3#%25E8%25A7%25A3%25E7%25AD%2594-%25E3%2582%25BB%25E3%2582%25AF%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%25B3%25E3%2582%2592%25E7%25AE%25A1%25E7%2590%2586%25E3%2581%2597%25E3%2582%2584%25E3%2581%2599%25E3%2581%258F%25E3%2581%2599%25E3%2582%258B"},"Practice7_Section1_MainViewController_1.swift":{"syntax":"swift","content":["import Combine","import IllustAPIMock","import UIKit","","class MainViewController: UIViewController {","    @IBOutlet private weak var collectionView: UICollectionView! {","        didSet {","            collectionView.delegate = self","            collectionView.dataSource = self","            registerCells()","        }","    }","    @IBOutlet private weak var loadingView: UIActivityIndicatorView!","","    private var sections: [Section] = [] {","        didSet {","            Task { @MainActor in","                self.collectionView.collectionViewLayout = {","                    let layout = UICollectionViewCompositionalLayout { (sectionIndex, environment) -> NSCollectionLayoutSection? in","                        return self.sections[sectionIndex].layoutSection()","                    }","                    return layout","                }()","                self.collectionView.reloadData()","            }","        }","    }","","    private let viewModel = IllustViewModel(api: IllustAPIMock())","    private var cancellables = Set<AnyCancellable>()","","    override func viewDidLoad() {","        super.viewDidLoad()","","        viewModel.$rankingIllusts","            .combineLatest(viewModel.$recommendedIllusts)","            .receive(on: DispatchQueue.main)","            .sink { [weak self] rankingIllusts, recommendedIllusts in","                guard let self = self else {","                    return","                }","                self.sections = [","                    RankingIllustSection(illusts: rankingIllusts),","                    IllustSection(illusts: recommendedIllusts, parentWidth: self.view.bounds.width)","                ]","            }","            .store(in: &cancellables)","","        viewModel.$isRequesting","            .receive(on: DispatchQueue.main)","            .sink { [weak self] isRequesting in","                self?.loadingView.isHidden = !isRequesting","            }","            .store(in: &cancellables)","","        Task {","            await viewModel.fetchIllusts()","        }","    }","}","","extension MainViewController: UIScrollViewDelegate {","    func scrollViewDidScroll(_ scrollView: UIScrollView) {","        \/\/ ここに判定の処理を書いていく","    }","}","","extension MainViewController {","    private func registerCells() {","        collectionView.register(UINib(nibName: \"HeaderCell\", bundle: nil), forSupplementaryViewOfKind: \"RecommendedHeader\", withReuseIdentifier: \"HeaderCell\")","        collectionView.register(UINib(nibName: \"HeaderCell\", bundle: nil), forSupplementaryViewOfKind: \"RankingHeader\", withReuseIdentifier: \"HeaderCell\")","        collectionView.register(UINib(nibName: \"IllustCell\", bundle: nil),  forCellWithReuseIdentifier: \"IllustCell\")","        collectionView.register(UINib(nibName: \"RankingIllustCell\", bundle: nil),  forCellWithReuseIdentifier: \"RankingIllustCell\")","    }","}","","extension MainViewController: UICollectionViewDelegate {","}","","extension MainViewController: UICollectionViewDataSource {","    func numberOfSections(in collectionView: UICollectionView) -> Int {","        return sections.count","    }","","    func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -> Int {","        return sections[section].numberOfItems","    }","","    func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -> UICollectionViewCell {","        return sections[indexPath.section].configureCell(collectionView: collectionView, indexPath: indexPath)","    }","","    func collectionView(_ collectionView: UICollectionView, viewForSupplementaryElementOfKind kind: String, at indexPath: IndexPath) -> UICollectionReusableView {","        guard let header = collectionView.dequeueReusableSupplementaryView(ofKind: kind, withReuseIdentifier: \"HeaderCell\", for: indexPath) as? HeaderCell else {","            fatalError()","        }","        switch kind {","        case \"RecommendedHeader\":","            header.bind(\"Recommended\")","            return header","        case \"RankingHeader\":","            header.bind(\"Ranking\")","            return header","        default:","            fatalError()","         }","    }","}"],"fileName":"MainViewController.swift","identifier":"Practice7_Section1_MainViewController_1.swift","type":"file","fileType":"swift","highlights":[{"line":8},{"line":62},{"line":63},{"line":64},{"line":65},{"line":66},{"line":67},{"line":77},{"line":78},{"line":79}]},"doc://net.pixiv.training.Tutorial/tutorials/Tutorial/Practice8":{"role":"project","title":"課題8: いいねボタンを実装してみよう","estimatedTime":"1hr 0min","abstract":[{"type":"text","text":"おすすめのイラストのCellにいいねボタンを表示してみましょう。また、いいねしたことをAPIを叩いて記録しましょう。いいねを取り消す処理は実装しなくても大丈夫です"}],"identifier":"doc:\/\/net.pixiv.training.Tutorial\/tutorials\/Tutorial\/Practice8","kind":"project","type":"topic","url":"\/tutorials\/tutorial\/practice8"}}}